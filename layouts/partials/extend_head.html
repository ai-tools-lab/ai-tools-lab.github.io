{{/* Performance: DNS Prefetch & Preconnect */}}
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>

{{/* Critical CSS */}}
<style>body{margin:0}img,video{max-width:100%;height:auto}.post-content{line-height:1.8}</style>

{{/* PWA */}}
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#2563eb">
<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js');}
</script>

{{/* JSON-LD Structured Data for SEO */}}

{{/* Organization Schema - all pages */}}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "AI Tools Lab",
  "url": "{{ .Site.BaseURL }}",
  "logo": "{{ .Site.BaseURL }}images/logo.png",
  "sameAs": [
    "https://twitter.com/aitoolslab",
    "https://github.com/ai-tools-lab"
  ]
}
</script>

{{/* Article Schema - single posts only */}}
{{ if and (eq .Section "posts") .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "{{ .Title }}",
  "description": "{{ .Description | default .Summary | plainify | truncate 160 }}",
  "image": "{{ with .Params.cover.image }}{{ . | absURL }}{{ end }}",
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  "author": {
    "@type": "Organization",
    "name": "AI Tools Lab"
  },
  "publisher": {
    "@type": "Organization",
    "name": "AI Tools Lab",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ .Site.BaseURL }}images/logo.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  }
  {{ with .Params.keywords }},"keywords": "{{ delimit . ", " }}"{{ end }}
}
</script>
{{ end }}

{{/* BreadcrumbList Schema */}}
{{ if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ .Site.BaseURL }}"
    }
    {{ if .Section }},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "{{ .Section | humanize | title }}",
      "item": "{{ .Site.BaseURL }}{{ .Section }}/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ .Title }}",
      "item": "{{ .Permalink }}"
    }
    {{ end }}
  ]
}
</script>
{{ end }}

{{/* Google Analytics 4 */}}
{{ with .Site.Params.analytics.google }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ . }}');
</script>
{{ end }}
